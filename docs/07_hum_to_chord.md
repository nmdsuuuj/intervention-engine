# 07. 鼻歌解析 (Hum-to-Chord) 仕様書

## 1. 概要 (Overview)
ユーザーの「鼻歌（ハミング）」を「人間的なグルーヴ（揺れ）」と「介入的なハーモニー」に変換するモジュール。

## 2. ステップ1：録音プロセス (Recording Process)
* `[Hum]` ボタン（`docs/08` COLUMN_1）を押し、**BPMクリック**に合わせてハミングを録音する。
* 録音されたオーディオは「アレンジ・ビュー」（`docs/01`）の `[Audio (歌)]` レーンに波形として配置される。
* `pitch_detector_dart` 等で、ピッチ（音高）とタイミング（発音開始点）の時系列データを抽出する。

## 3. ステップ2：リズム解析とモード選択 (Rhythm Analysis & Mode Selection)
* ユーザーに**「タイミング（グルーヴ）の扱い方」**を問う。
    1.  **[ グルーヴ・モード (Groove Mode) ]**: 鼻歌の**「タイミングの揺れ」や「ズレ」を、そのまま活かす**。（`docs/04`の`[フリー]`スナップの基礎データとなる）
    2.  **[ クオンタイズ・モード (Quantize Mode) ]**: タイミングを最も近いグリッドに**補正（クオンタイズ）**する。

## 4. ステップ3：ハーモニー解析と介入 (Harmony Analysis & Intervention)
* ユーザーに**「どの『価値観』のハーモニーを当てますか？」**と問う。
    1.  **[ セットA：スタンダード (Standard) ]**: `I - V - vi - IV` など、音楽理論的に「正しい」進行。
    2.  **[ セットB：モーダル / Neo-Soul (Modal) ]**: テンション（9th, 11th）を多用する。
    3.  **[ セットC：ビートルズ / 介入 (Intervention) ]**: **「介入エンジン」**が作動。メロディに対し、あえて`rock_bVII_injection`（`Bb`）や`parallelMinor_borrowing`（`Eb`）をぶつけた「奇妙な」進行を提案する。

## 5. ステップ4：アンサンブルへの生成 (Generation to Ensemble)
* ユーザーが「Groove Mode」と「セットC」を選ぶと、`Melody` トラックに「揺れた」ノートが、`Chord` トラック（`[Chord / Lyric]` レーン）に「奇妙な」コードが自動生成される。
