# プロジェクト名（仮）: "Intervention Engine" (介入エンジン)

## 1. 🎯 コア・コンセプト (プロジェクトの哲学)

これは、単なる作曲支援アプリではない。
これは、**「予測可能（平凡）な音楽」を「予測不能（奇妙）だが魅力的」な音楽へと「破壊・再構築」するためのアンサムブル実験室**である。

このアプリの目的は、ビートルズ（特にレノンとポール）、ローリング・ストーンズ、キンクス、テレヴィジョン、シド・バレット、キャプテン・ビーフハート、マイケル・ジャクソンのような「型破り」なアーティストが、**なぜ「間違い」を「個性」に変えられたのか**、その音楽理論的（あるいは反・理論的）な「介入技法」を**「分析・構造化」**し、AI（＝パターン適用アルゴリズム）として組み込むことである。

**最重要方針:**
1.  **価値観に基づく介入:** 介入はカオス（ランダム）からではなく、「分析・構造化された素人っぽさ（例：ビートルズの`bVII`介入）」という**「価値観」**に基づいて実行される。
2.  **パターン（技法）の再利用:** 本アプリの「AI」とは、高価なサーバー「生成AI」のことでは**ない**。「分析されたパターン」を、異なるキーや構造に「変形・応用」して再利用する、**アプリ内完結型のロジック（アルゴリズム）**である。
3.  **グルーヴ感の重要性:**
    * **構造的グルーヴ（ズレ）:** ビーフハート的な「素数ループ（`loop_setPrime`）」による、同期しないポリリズム。
    * **人間的グルーヴ（揺れ）:** 「鼻歌解析」機能の「グルーヴ・モード」により、ユーザーのタイミングの「揺れ」を意図的に活かす。
    * **編集可能なグルーヴ:** 「グルーヴ・テンプレート」機能（`docs/05`参照）により、トラック毎・小節毎にグルーヴの「種類」と「度合い」を自在に編集できる。

## 2. 🏛️ アプリの3大アーキテクチャ

### ① 介入エンジン (The "Artist Brain") - *最重要*
* **役割:** アプリの「魂」。ユーザーの平凡なアイデアに「奇妙な技法」で介入するアルゴリズム。
* **設計:** **「データ駆動型」**であること。
    * アプリのコアロジック（再生エンジン）と、「技法」のデータベース（JSON）は**完全に分離**する。
    * `assets/data/techniques/` フォルダに、"If I Fell", "Satisfaction", "Marquee Moon" などの分析から抽出した「深層分析データ」（例: `rule_voiceLeading_bIII`, `rule_riff_vs_vocal`）を格納する。
    * `assets/data/models/` フォルダに、`lennon.json`, `stones.json` など、`techniques` を組み合わせた「アーティストの思考プリセット」を格納する。
* **利点:** この設計により、アプリ本体を再ビルドすることなく、**JSONファイルを追加・編集するだけでAI（介入エンジン）を無限に賢くできる（＝拡張性）**。

### ② グルーヴ・エンジン (The "Rhythm Core")
* **役割:** 楽曲の「心臓部」。
* **機能:**
    * **4トラック（MIDI）シーケンサー:** `[Drums]`, `[Bass]`, `[Chord]`, `[Melody]` の4トラックで構成。
    * **1トラック（Audio）シーケンサー:** `[Audio (歌)]` レーン。（v2.0で「4トラックMTR」に拡張 `docs/09` 参照）
    * **フェイズ・モード（ビーフハート・モード）:** 4つのMIDIトラックが、それぞれ**独立したループ長（ステップ数）**を持てる。

### ③ エクスポート・モジュール (The "Bridge")
* **役割:** アプリ内の「実験」を、現実の「作曲」に橋渡しする。
* **機能:** MIDI書き出し、ギター・ビュー（コード表/タブ譜）、ピアノ・ビュー。

## 3. 🧬 主要機能（ワークフロー）

### 1. `[ コード生成 ]` ボタン
* **役割:** 曲の「叩き台」を生成する。
* **ロジック:** 「王道パターン（カノン進行など）」だけでなく、`techniques/` データベースにある「奇妙なパターン」（例：ビートルズ初期の「曖昧な」`iv` 介入、"Satisfaction" の「リフ先行」構造、"Don't Stop..." の「レイヤリング」構造）を**最初から適用**したコード進行を生成する。

### 2. `[ MUTATE (介入) ]` ボタン (ワークフローの核)
* **役割:** ユーザーが「ヒント」を欲しい時に押す、能動的な介入トリガー。
* **ワークフロー:**
    1.  ユーザーが編集したい範囲（例：「ベース」の「16小節目」）を選択する。
    2.  `[ MUTATE ]` ボタンを押す。
    3.  **ポップアップで「複数の価値観」が提案される。**
        * **▼ グルーヴの介入**
        * `[ 提案A (J Dilla) ]`: この小節だけ「ヨレた」グルーヴに変更
        * **▼ 奏法の介入**
        * `[ 提案B (ポール風フィル) ]`: `art_mccartney_fill_01` を適用
        * **▼ コード/パターンの介入**
        * `[ 提案C (ジョン・レノン) ]`: "Walrus" 風の `bIII` を暗示するベース
    4.  ユーザーは「試聴」し、気に入った提案を「決定」する。

### 3. スナップ機能 (Snap)
* **設定:** `[ 小節 ]` `[ 拍 ]` `[ グリッド ]` **`[ フリー ]`** の4種類をユーザーが自由に切り替えられる。
* **目的:** 「カッチリした」編集と、「人間的なグルーヴ（揺れ）」を活かした編集（`[フリー]`）の両方を可能にする。

## 4. 🗃️ コア・システム要件

### 1. セッション保存機能 (Project Save/Load)
* **必須要件:** ユーザーの「実験（作曲）」の成果（全トラック、オーディオ、介入設定）を失わないため、プロジェクト全体を保存・読み込みできる。

### 2. Undo（元に戻す）機能
* **必須要件:** **「介入」の実行（`[ MUTATE ]` ボタン押下）は、必ず「Undo（元に戻す）」スタックに追加されなければならない。**
* **目的:** ユーザーが「安心して冒険できる」環境を保証する。

## 5. 🛠️ 技術スタック（推奨）

* **プラットフォーム:** Android (スマホ), Windows (ノートPC)
* **推奨フレームワーク:** **Flutter**
